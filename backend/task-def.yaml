family: dev-datti-backend
networkMode: bridge
executionRoleArn: "arn:aws:iam::{{ must_env `AWS_ACCOUNT_ID` }}:role/dev-datti-ecs-execution-role"
taskRoleArn: "arn:aws:iam::{{ must_env `AWS_ACCOUNT_ID` }}:role/dev-datti-ecs-task-role"
containerDefinitions:
  - name: dev-datti-backend
    image: "{{ must_env `AWS_ACCOUNT_ID` }}.dkr.ecr.ap-northeast-1.amazonaws.com/dev-datti-backend:{{ must_env `IMAGE_TAG` }}"
    cpu: 128
    memory: 256
    essential: true
    portMappings:
      - containerPort: 8080
        hostPort: 8081
        protocol: tcp
    environment:
      - name: PORT
        value: "8080"
      - name: OTEL_EXPORTER_OTLP_ENDPOINT
        value: "http://localhost:4318"
    secrets:
      - name: DSN
        valueFrom: "arn:aws:ssm:ap-northeast-1:{{ must_env `AWS_ACCOUNT_ID` }}:parameter/datti/dev/backend/DSN"
    logConfiguration:
      logDriver: awslogs
      options:
        awslogs-group: /ecs/dev-datti-backend
        awslogs-region: ap-northeast-1
        awslogs-stream-prefix: ecs
  - name: aws-otel-collector
    image: amazon/aws-otel-collector:latest
    cpu: 64
    memory: 128
    essential: false
    command:
      - "--config=/etc/ecs/ecs-default-config.yaml"
requiresCompatibilities:
  - EC2
cpu: "256"
memory: "512"
